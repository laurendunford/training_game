<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Guidewheel: Factory Director</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;600;700&family=Inter:wght@400;600&display=swap');
        
        body { font-family: 'Inter', sans-serif; background-color: #f1f5f9; }
        h1, h2, h3, .brand-font { font-family: 'Space Grotesk', sans-serif; }
        
        /* Animations */
        @keyframes popIn { 0% { opacity: 0; transform: scale(0.9) translateY(20px); } 100% { opacity: 1; transform: scale(1) translateY(0); } }
        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-5px); } }
        @keyframes slideUp { 0% { transform: translateY(100%); opacity: 0; } 100% { transform: translateY(0); opacity: 1; } }

        .animate-pop { animation: popIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1); }
        .animate-shake { animation: shake 0.3s ease-in-out; }
        .animate-float { animation: float 3s ease-in-out infinite; }
        .animate-slide-up { animation: slideUp 0.5s ease-out forwards; }

        .stat-card { transition: all 0.3s ease; }
        .stat-change-pill { opacity: 0; transform: translateY(10px); transition: all 0.5s ease; }
        .stat-change-pill.show { opacity: 1; transform: translateY(0); }

        .choice-btn {
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            border-bottom-width: 4px;
        }
        .choice-btn:active {
            transform: translateY(2px);
            border-bottom-width: 0px;
        }

        /* Avatar styling */
        .avatar-ring {
            box-shadow: 0 0 0 4px rgba(255, 255, 255, 0.5), 0 0 0 6px rgba(59, 130, 246, 0.5);
        }
    </style>
</head>
<body class="text-slate-800 h-screen flex flex-col overflow-hidden bg-slate-100">

    <!-- Header / HUD -->
    <header class="bg-white px-6 py-4 shadow-md z-20 flex justify-between items-center shrink-0 border-b border-slate-200">
        <div class="flex items-center gap-3">
            <div class="w-10 h-10 bg-indigo-600 rounded-xl flex items-center justify-center text-white shadow-lg shadow-indigo-200">
                <i data-lucide="gamepad-2" class="w-6 h-6"></i>
            </div>
            <div>
                <h1 class="font-bold text-lg leading-tight text-slate-900 brand-font">FACTORY DIRECTOR</h1>
                <p class="text-xs text-slate-500 font-semibold uppercase tracking-wider">Guidewheel Simulation</p>
            </div>
        </div>

        <div class="flex gap-4">
            <!-- Trust Metric -->
            <div class="stat-card bg-slate-50 px-4 py-2 rounded-xl border border-slate-200 flex flex-col w-32 relative overflow-hidden group">
                <div class="flex justify-between items-center z-10">
                    <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Trust</span>
                    <i data-lucide="users" class="w-4 h-4 text-blue-500"></i>
                </div>
                <div class="text-2xl font-black text-slate-800 z-10 relative">
                    <span id="score-trust">50</span>%
                    <span id="pill-trust" class="stat-change-pill absolute -right-2 top-1 text-xs font-bold px-1.5 py-0.5 rounded bg-blue-100 text-blue-700">+10</span>
                </div>
                <div id="bar-trust" class="absolute bottom-0 left-0 h-1 bg-blue-500 transition-all duration-1000" style="width: 50%"></div>
            </div>

            <!-- OEE Metric -->
            <div class="stat-card bg-slate-50 px-4 py-2 rounded-xl border border-slate-200 flex flex-col w-32 relative overflow-hidden group">
                <div class="flex justify-between items-center z-10">
                    <span class="text-xs font-bold text-slate-400 uppercase tracking-wider">Efficiency</span>
                    <i data-lucide="zap" class="w-4 h-4 text-amber-500"></i>
                </div>
                <div class="text-2xl font-black text-slate-800 z-10 relative">
                    <span id="score-oee">50</span>%
                    <span id="pill-oee" class="stat-change-pill absolute -right-2 top-1 text-xs font-bold px-1.5 py-0.5 rounded bg-amber-100 text-amber-700">+5</span>
                </div>
                <div id="bar-oee" class="absolute bottom-0 left-0 h-1 bg-amber-500 transition-all duration-1000" style="width: 50%"></div>
            </div>
        </div>
    </header>

    <!-- Game Stage -->
    <main id="stage" class="flex-1 relative flex flex-col items-center justify-center p-4 overflow-hidden w-full max-w-4xl mx-auto">
        <!-- Dynamic Content -->
    </main>

    <!-- Overlay: Crisis / Event -->
    <div id="event-overlay" class="absolute inset-0 bg-slate-900/80 backdrop-blur-md z-50 hidden flex items-center justify-center p-6">
        <!-- Injected via JS -->
    </div>

    <script>
        const Game = {
            state: {
                trust: 50,
                oee: 50, // Started slightly higher since gains are slower now
                day: 1,
                sceneIndex: 0,
                history: []
            },
            
            // Characters add flavor
            chars: {
                frank: { name: "Frank", role: "Shift Foreman", color: "bg-orange-100 text-orange-700", avatar: "hard-hat" },
                sarah: { name: "Sarah", role: "CEO", color: "bg-purple-100 text-purple-700", avatar: "briefcase" },
                system: { name: "Guidewheel", role: "AI Assistant", color: "bg-blue-100 text-blue-700", avatar: "bot" }
            },

            // The Narrative
            timeline: [
                {
                    id: 'strategy',
                    speaker: 'sarah',
                    mood: 'neutral',
                    title: "The Launch Strategy",
                    text: "The sensors are live and data is flowing. We need to prove this works. How should we approach the rollout?",
                    choices: [
                        {
                            text: "The 'Big Bang' Fix",
                            subtext: "Try to fix every downtime cause across the plant immediately.",
                            impact: { trust: -10, oee: -2 }, 
                            response: { speaker: 'frank', text: "It's chaos. You sent us 50 different charts and now everyone is running around fighting fires. We need focus!" }
                        },
                        {
                            text: "Target a 'Quick Win'",
                            subtext: "Focus on the Bottleneck to solve one major pain point.",
                            impact: { trust: +10, oee: +5 },
                            response: { speaker: 'system', text: "Excellent. By solving one specific problem on the bottleneck, you proved the value immediately. The team is excited for more." }
                        }
                    ]
                },
                {
                    id: 'intro',
                    speaker: 'frank',
                    mood: 'skeptical',
                    title: "Communicating the 'Why'",
                    text: "Okay, we're focusing on a Quick Win. But the guys are asking if you're trying to fire them with these trackers. It feels like Big Brother.",
                    choices: [
                        {
                            text: "It's mandatory monitoring.",
                            subtext: "Tell them: 'If you're doing your job, you have nothing to hide.'",
                            impact: { trust: -20, oee: +2 }, 
                            response: { speaker: 'frank', text: "Great. Now everyone thinks you're looking for reasons to fire them. Expect morale to tank." }
                        },
                        {
                            text: "It's Support, Not Surveillance.",
                            subtext: "Tell them: 'We can ALL see what's happening so we can fix the machine, not blame the operator.'",
                            impact: { trust: +15, oee: +0 },
                            response: { speaker: 'frank', text: "Okay, that makes sense. If it helps us prove the machine is the problem—and gets Maintenance here faster—I can sell that." }
                        }
                    ]
                },
                {
                    id: 'downtime',
                    speaker: 'system',
                    mood: 'alert',
                    title: "CRITICAL ALERT: LINE 3",
                    text: "Line 3 just stopped. It's been down for 45 minutes. The dashboard is flashing red. Frank looks nervous.",
                    choices: [
                        {
                            text: "Blame the Operator",
                            subtext: "Walk out there and demand answers!",
                            impact: { trust: -15, oee: +0 },
                            response: { speaker: 'frank', text: "Hey! The machine jammed! Yelling at Mike won't unjam it faster. Now he's afraid to tag reasons." }
                        },
                        {
                            text: "Investigate the Data",
                            subtext: "Look at the current spikes before the stop.",
                            impact: { trust: +10, oee: +5 }, 
                            response: { speaker: 'system', text: "Fact-based leadership. Motor current spiked 300% before failure. We've set up alerts so we can catch problems like this earlier and keep our team safe." }
                        }
                    ]
                },
                {
                    id: 'resistance',
                    speaker: 'frank',
                    mood: 'worried',
                    title: "The Resistance",
                    text: "'Old School Joe' refuses to use the iPad. He says he's been running this press for 20 years and doesn't need a gadget.",
                    choices: [
                        {
                            text: "Mandate Training",
                            subtext: "Make it a requirement. Send him to HR.",
                            impact: { trust: -5, oee: 0 },
                            response: { speaker: 'frank', text: "He's filling it out, but he's entering 'Unknown' for everything. Passive resistance." }
                        },
                        {
                            text: "Peer Champion",
                            subtext: "Have a veteran operator show him.",
                            impact: { trust: +15, oee: +3 },
                            response: { speaker: 'frank', text: "Joe listened to Pete. Once he saw Pete using it to prevent a breakdown, Joe got curious. Social proof works." }
                        }
                    ]
                },
                {
                    id: 'transparency',
                    speaker: 'sarah',
                    mood: 'neutral',
                    title: "Setting the Scoreboard",
                    text: "The data is verified and the team trusts it. We're ready to turn on the Shop Floor Scoreboards. How should we set the targets?",
                    choices: [
                        {
                            text: "Push for Perfection",
                            subtext: "Set the target to 100% capacity. Make them chase it.",
                            impact: { trust: -15, oee: -5 }, 
                            response: { speaker: 'frank', text: "The board is bleeding RED all day. The team feels like they can't win no matter how hard they work, so they stopped trying." }
                        },
                        {
                            text: "Achievable Wins",
                            subtext: "Set a target they can hit, then raise it later.",
                            impact: { trust: +15, oee: +5 }, 
                            response: { speaker: 'system', text: "Psychological Win! The board turned GREEN. The team high-fived. Now that they know they can win, they are ready to raise the bar next week." }
                        }
                    ]
                },
                {
                    id: 'sustain',
                    speaker: 'frank',
                    mood: 'happy',
                    title: "The Monthly Rhythm",
                    text: "Things are running smooth. Are we done? Can I go back to my old clipboard?",
                    choices: [
                        {
                            text: "Yeah, we're good.",
                            subtext: "Set it and forget it.",
                            impact: { trust: 0, oee: -5 }, 
                            response: { speaker: 'system', text: "Alert: Usage dropping. Old habits returning. Without 'Leader Standard Work', entropy sets in." }
                        },
                        {
                            text: "No! 'Win the Week' meetings.",
                            subtext: "Start a weekly 15-min standup on trends.",
                            impact: { trust: +10, oee: +6 }, 
                            response: { speaker: 'frank', text: "Weekly standups? Okay. It actually helps to see where we improved over the week. Continuous Improvement!" }
                        }
                    ]
                }
            ],

            init() {
                lucide.createIcons();
                this.updateStats(0, 0); // Init visuals
                this.renderScene();
            },

            // --- CORE RENDERER ---

            renderScene() {
                const stage = document.getElementById('stage');
                
                // End Game Check
                if (this.state.sceneIndex >= this.timeline.length) {
                    this.renderEndGame();
                    return;
                }

                const scene = this.timeline[this.state.sceneIndex];
                const char = this.chars[scene.speaker];
                
                stage.innerHTML = `
                    <div class="w-full max-w-2xl animate-pop">
                        <!-- Character Bubble -->
                        <div class="flex items-end gap-4 mb-6">
                            <div class="shrink-0 relative">
                                <div class="w-16 h-16 rounded-2xl ${char.color} flex items-center justify-center shadow-lg border-2 border-white avatar-ring animate-float">
                                    <i data-lucide="${char.avatar}" class="w-8 h-8"></i>
                                </div>
                            </div>
                            <div class="bg-white p-6 rounded-2xl rounded-bl-none shadow-xl border border-slate-100 flex-1 relative">
                                <div class="absolute -left-2 bottom-6 w-4 h-4 bg-white transform rotate-45 border-l border-b border-slate-100"></div>
                                <div class="flex justify-between items-start mb-2">
                                    <div>
                                        <h2 class="text-sm font-bold text-slate-400 uppercase tracking-widest">${char.role}</h2>
                                        <h3 class="text-xl font-bold text-slate-900 brand-font">${scene.title}</h3>
                                    </div>
                                    <span class="px-3 py-1 bg-slate-100 rounded-full text-xs font-bold text-slate-500">Day ${this.state.day}</span>
                                </div>
                                <p class="text-lg text-slate-700 leading-relaxed">"${scene.text}"</p>
                            </div>
                        </div>

                        <!-- Choices -->
                        <div class="grid md:grid-cols-2 gap-4 mt-8">
                            ${scene.choices.map((c, i) => `
                                <button onclick="Game.handleChoice(${i})" class="choice-btn group bg-white border border-b-4 border-slate-200 hover:border-indigo-500 hover:bg-indigo-50 p-6 rounded-xl text-left transition-all relative overflow-hidden">
                                    <div class="absolute inset-0 bg-indigo-500 opacity-0 group-hover:opacity-5 transition-opacity"></div>
                                    <h4 class="font-bold text-lg text-slate-800 mb-1 group-hover:text-indigo-700">${c.text}</h4>
                                    <p class="text-sm text-slate-500 font-medium">${c.subtext}</p>
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
                lucide.createIcons();
            },

            handleChoice(idx) {
                const scene = this.timeline[this.state.sceneIndex];
                const choice = scene.choices[idx];

                // 1. Update Stats & Juice
                this.updateStats(choice.impact.trust, choice.impact.oee);

                // 2. Show Immediate Feedback (The "Juice")
                const stage = document.getElementById('stage');
                const isPositive = choice.impact.trust + choice.impact.oee >= 0;
                
                if(!isPositive) document.body.classList.add('animate-shake');
                setTimeout(() => document.body.classList.remove('animate-shake'), 500);

                const feedbackColor = isPositive ? 'bg-green-100 border-green-200 text-green-800' : 'bg-red-50 border-red-200 text-red-800';
                const feedbackIcon = isPositive ? 'check-circle' : 'alert-triangle';

                stage.innerHTML = `
                    <div class="max-w-md w-full animate-slide-up">
                        <div class="${feedbackColor} border-2 p-8 rounded-3xl shadow-2xl text-center relative overflow-hidden">
                            <div class="absolute top-0 left-0 w-full h-2 bg-gradient-to-r from-transparent via-white to-transparent opacity-50"></div>
                            
                            <div class="mx-auto w-16 h-16 rounded-full bg-white/50 flex items-center justify-center mb-4">
                                <i data-lucide="${feedbackIcon}" class="w-8 h-8"></i>
                            </div>
                            
                            <h2 class="text-2xl font-black mb-2 brand-font">"${choice.text}"</h2>
                            <div class="h-px w-20 bg-current opacity-20 mx-auto my-4"></div>
                            <p class="text-lg font-medium opacity-90 mb-8">"${choice.response.text}"</p>
                            
                            <div class="flex justify-center gap-4 mb-8 text-sm font-bold">
                                <span class="${choice.impact.trust >= 0 ? 'text-green-700' : 'text-red-700'} bg-white/50 px-3 py-1 rounded-lg">
                                    ${choice.impact.trust > 0 ? '+' : ''}${choice.impact.trust} Trust
                                </span>
                                <span class="${choice.impact.oee >= 0 ? 'text-green-700' : 'text-red-700'} bg-white/50 px-3 py-1 rounded-lg">
                                    ${choice.impact.oee > 0 ? '+' : ''}${choice.impact.oee} OEE
                                </span>
                            </div>

                            <button onclick="Game.triggerEvent()" class="w-full py-4 bg-slate-900 text-white font-bold rounded-xl hover:scale-105 active:scale-95 transition-transform shadow-lg">
                                End Day ${this.state.day}
                            </button>
                        </div>
                    </div>
                `;
                lucide.createIcons();
            },

            // --- CRISIS ENGINE (The Random Element) ---

            triggerEvent() {
                // 30% chance of random event
                if (Math.random() > 0.3 && this.state.sceneIndex < this.timeline.length - 1) {
                    this.renderCrisis();
                } else {
                    this.nextDay();
                }
            },

            renderCrisis() {
                const events = [
                    { 
                        title: "Pareto Attack", 
                        text: "You and the Guidewheel team analyze the top downtime reason: 'Infeed Jams'. Together, you implement a fix that eliminates 80% of the stops.", 
                        impact: { trust: +10, oee: +4 }, // Realistic incremental gain
                        icon: "crosshair" 
                    },
                    { 
                        title: "Operator Insight", 
                        text: "Because the data is transparent, an operator notices a recurring current spike and suggests a fix before the machine actually breaks.", 
                        impact: { trust: +15, oee: +2 }, 
                        icon: "lightbulb" 
                    },
                    { 
                        title: "Perfect Handoff", 
                        text: "Night shift checks the Scoreboard and knows exactly where Day shift left off. Zero ramp-up time lost during the shift change.", 
                        impact: { trust: +5, oee: +3 }, 
                        icon: "users" 
                    },
                    { 
                        title: "The 'Win' Celebration", 
                        text: "The team hit their weekly OEE goal! You celebrate the specific win, reinforcing the connection between effort and results.", 
                        impact: { trust: +10, oee: +1 }, 
                        icon: "party-popper" 
                    }
                ];
                const event = events[Math.floor(Math.random() * events.length)];

                // Update stats quietly
                this.state.trust += event.impact.trust;
                this.state.oee += event.impact.oee;
                this.updateStats(event.impact.trust, event.impact.oee);

                const overlay = document.getElementById('event-overlay');
                overlay.innerHTML = `
                    <div class="bg-white p-8 rounded-2xl shadow-2xl max-w-sm w-full text-center animate-pop border-b-8 border-indigo-600">
                        <div class="w-16 h-16 bg-slate-100 rounded-full mx-auto flex items-center justify-center mb-4 text-slate-700">
                            <i data-lucide="${event.icon}" class="w-8 h-8"></i>
                        </div>
                        <h3 class="text-xs font-bold text-indigo-600 uppercase tracking-widest mb-1">Shift Victory</h3>
                        <h2 class="text-2xl font-black text-slate-900 mb-2 brand-font">${event.title}</h2>
                        <p class="text-slate-600 mb-6">${event.text}</p>
                        <button onclick="Game.nextDay()" class="w-full py-3 bg-slate-100 text-slate-900 font-bold rounded-xl hover:bg-slate-200">Continue</button>
                    </div>
                `;
                lucide.createIcons();
                overlay.classList.remove('hidden');
            },

            nextDay() {
                document.getElementById('event-overlay').classList.add('hidden');
                this.state.day += 7; // Time skip
                this.state.sceneIndex++;
                this.renderScene();
            },

            // --- UI HELPERS ---

            updateStats(dTrust, dOEE) {
                // Bounds: Trust 0-100, OEE 0-85 (World Class Max)
                this.state.trust = Math.min(100, Math.max(0, this.state.trust + dTrust));
                this.state.oee = Math.min(85, Math.max(0, this.state.oee + dOEE));

                // DOM
                document.getElementById('score-trust').innerText = this.state.trust;
                document.getElementById('bar-trust').style.width = this.state.trust + '%';
                
                document.getElementById('score-oee').innerText = this.state.oee;
                // Bar width still relative to 100 for visual simplicity, or map 85 to 100? 
                // Keeping relative to 100 helps visualize the '85% ceiling' better.
                document.getElementById('bar-oee').style.width = this.state.oee + '%';

                // Pills
                if(dTrust !== 0) this.showPill('trust', dTrust);
                if(dOEE !== 0) this.showPill('oee', dOEE);
            },

            showPill(type, val) {
                const pill = document.getElementById(`pill-${type}`);
                pill.innerText = (val > 0 ? '+' : '') + val;
                pill.className = `stat-change-pill absolute -right-2 top-1 text-xs font-bold px-1.5 py-0.5 rounded ${val > 0 ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'} show`;
                setTimeout(() => pill.classList.remove('show'), 2000);
            },

            renderEndGame() {
                const isWin = this.state.trust > 60 && this.state.oee > 60;
                const stage = document.getElementById('stage');
                
                stage.innerHTML = `
                    <div class="text-center max-w-lg w-full animate-pop">
                        <div class="w-24 h-24 mx-auto mb-6 rounded-full flex items-center justify-center ${isWin ? 'bg-yellow-100 text-yellow-600' : 'bg-slate-200 text-slate-500'}">
                            <i data-lucide="${isWin ? 'crown' : 'frown'}" class="w-12 h-12"></i>
                        </div>
                        <h1 class="text-4xl font-black text-slate-900 mb-4 brand-font">${isWin ? 'FACTORY LEGEND' : 'TURNAROUND FAILED'}</h1>
                        <p class="text-xl text-slate-600 mb-8">${isWin ? 'You balanced culture and performance perfectly. The factory is humming.' : 'The culture is toxic or the machines are idle. It\'s a tough balance.'}</p>
                        
                        <div class="grid grid-cols-2 gap-4 mb-8">
                            <div class="p-4 bg-white rounded-xl shadow-sm border border-slate-200">
                                <div class="text-xs uppercase font-bold text-slate-400">Final Trust</div>
                                <div class="text-3xl font-black text-blue-600">${this.state.trust}</div>
                            </div>
                            <div class="p-4 bg-white rounded-xl shadow-sm border border-slate-200">
                                <div class="text-xs uppercase font-bold text-slate-400">Final OEE</div>
                                <div class="text-3xl font-black text-amber-500">${this.state.oee}</div>
                            </div>
                        </div>

                        <button onclick="location.reload()" class="px-8 py-3 bg-indigo-600 text-white font-bold rounded-full hover:bg-indigo-700 shadow-lg shadow-indigo-200 transition-all hover:scale-105">
                            Play Again
                        </button>
                    </div>
                `;
                lucide.createIcons();
                if(isWin) this.triggerConfetti();
            },
            
            triggerConfetti() {
                // Simple CSS confetti could go here, omitting for single-file brevity
            }
        };

        Game.init();
    </script>
</body>
</html>